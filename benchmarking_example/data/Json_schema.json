{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/iadopt-variable.json",
  "title": "I-ADOPT decomposed variable",
  "description": "Single variable expressed in the compact JSON layout used for LLM-driven decomposition.",
  "type": "object",

  "required": ["label", "definition", "comment", "hasProperty", "hasObjectOfInterest"],

  "properties": {
    "label": {
      "type": "string",
      "description": "Variable name."
    },
    "definition": {
      "type": "string",
      "description": "Natural-language descriptive definition (from skos:definition)."
    },
    "comment": {
      "type": "string",
      "description": "Compact version of the definition, cleaned by an expert."
    },
    "hasProperty": {
      "type": "string",
      "description": "Property being observed (e.g. 'distance', 'temperature')."
    },
    "hasStatisticalModifier": {
      "type": "string",
      "description": "Statistical qualifier (e.g. 'maximum', 'latest')."
    },
    "hasMatrix": {
      "$ref": "#/$defs/entityOrSystem",
      "description": "The Matrix (Entity or System) that contains or surrounds the ObjectOfInterest. It must be an Entity or System (e.g. 'soil', 'ocean water', 'solar wind', 'organism'), not a method, instrument, unit, or geographical location."
    },
    "hasObjectOfInterest": {
      "$ref": "#/$defs/entityOrSystem",
      "description": "The main *Object of Interest* (Entity or System) that is being characterised."
    },
    "hasContextObject": {
      "$ref": "#/$defs/entityOrSystem",
      "description": "Additional background Entity or System that gives context to the Object of Interest."
    },
    "hasConstraint": {
      "type": "array",
      "description": "List of Constraints that limit the scope or state of the observation (e.g. 'nearest neighbour', 'dry', 'at 15°C').",
      "items": {
        "type": "object",
        "required": ["label", "on"],
        "properties": {
          "label": {
            "type": "string",
            "description": "Short phrase for the state or restriction (e.g. 'nearest neighbour', 'dry', 'at 15°C temperature', 'due to ingestion')."
          },
          "on": {
            "type": "string",
            "description": "What the constraint applies to (The name of a Property or Entity in this variable, e.g. 'distance', 'mass flux', 'habitat patch', 'organism')."
          }
        },
        "additionalProperties": false
      },
      "minItems": 1
    }
  },

  "additionalProperties": false,

  "$defs": {
    "entityOrSystem": {
      "description": "Either a simple label (e.g. 'soil', 'ocean water') or a structured system. Asymmetric systems have roles like 'hasSource' and 'hasTarget' (e.g. 'from vegetation to soil'); symmetric systems have a label and 'hasPart' list (e.g. 'line of intersection' with parts 'bedding plane' and 'horizontal plane').",
      "oneOf": [
        { "type": "string" },
        {
          "$comment": "Asymmetric system",
          "type": "object",
          "required": [
            "AsymmetricSystem",
            "hasSource",
            "hasTarget",
            "hasNumerator",
            "hasDenominator"
          ],
          "properties": {
            "AsymmetricSystem": { "type": "string" },
            "hasSource":        { "type": "string" },
            "hasTarget":        { "type": "string" }
          },
          "additionalProperties": false
        },
        {
          "$comment": "Symmetric system",
          "type": "object",
          "required": ["SymmetricSystem", "hasPart"],
          "properties": {
            "SymmetricSystem": { "type": "string" },
            "hasPart": {
              "type": "array",
              "items": { "type": "string" },
              "minItems": 1
            }
          },
          "additionalProperties": false
        }
      ]
    }
  }
}
